"use strict";(self.webpackChunkdevelopment_framework_docs=self.webpackChunkdevelopment_framework_docs||[]).push([[2510],{51596:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>a,toc:()=>h});var i=n(74848),r=n(28453);const s={title:"Authentication and Authorization"},o="Authentication and Authorization",a={id:"guides/development/architecture/authentication",title:"Authentication and Authorization",description:"Authentication is the act of validating that users are whom they claim to be.",source:"@site/docs/guides/development/architecture/authentication.md",sourceDirName:"guides/development/architecture",slug:"/guides/development/architecture/authentication",permalink:"/dm-docs/docs/guides/development/architecture/authentication",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Authentication and Authorization"},sidebar:"tutorialSidebar",previous:{title:"Architecture",permalink:"/dm-docs/docs/guides/development/architecture/"},next:{title:"Clean architecture",permalink:"/dm-docs/docs/guides/development/architecture/clean-architecture"}},c={},h=[{value:"The Authentication Server",id:"the-authentication-server",level:2},{value:"Single Page Web Application",id:"single-page-web-application",level:2},{value:"REST API",id:"rest-api",level:2}];function d(e){const t={a:"a",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h1,{id:"authentication-and-authorization",children:"Authentication and Authorization"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Authentication"})," is the act of validating that users are whom they claim to be.",(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.strong,{children:"Authorization"})," is the process of giving the user permission to access a specific resource or function."]}),"\n",(0,i.jsx)(t.p,{children:"The template demo app is set up with OAuth2 authentication and no authorization (Any authenticated user can do anything)."}),"\n",(0,i.jsx)(t.p,{children:"There are 3 main parts that are important to understand in this authentication setup. The OAuth2 authentication server, the SPA web app, and the REST-API."}),"\n",(0,i.jsx)(t.h2,{id:"the-authentication-server",children:"The Authentication Server"}),"\n",(0,i.jsxs)(t.p,{children:["There are many different ",(0,i.jsx)(t.em,{children:"authentication providers"})," (Keycloak, Azure, Google, Facebook, etc.), running their own implementation of the OAuth2 protocol. It is these servers' responsibility to have the user login and authenticate themselves. The authentication servers authenticate the users against their connected user database (e.g. Azure Active Directory)."]}),"\n",(0,i.jsxs)(t.p,{children:["If the user authenticate successfully, the auth server returns a ",(0,i.jsx)(t.strong,{children:"signed JSON Web Token"})," (JWT)."]}),"\n",(0,i.jsxs)(t.p,{children:["In Equinor, Azure AD is the ",(0,i.jsx)(t.em,{children:"go-to"})," auth provider.\n",(0,i.jsx)(t.a,{href:"https://docs.microsoft.com/en-us/azure/active-directory-b2c/tutorial-register-spa",children:"This guide"}),' helps you register an "App" on Azure and configure it for use with a Web App.']}),"\n",(0,i.jsx)(t.h2,{id:"single-page-web-application",children:"Single Page Web Application"}),"\n",(0,i.jsxs)(t.p,{children:["Clients that has a goal of obtaining an access token (JWT), has many different ",(0,i.jsx)(t.em,{children:"flows"}),"/methods  to chose from. For Single Page Web Application the recommended flow is  the ",(0,i.jsx)(t.em,{children:"Authorization Code flow with PKCE"}),".",(0,i.jsx)(t.br,{}),"\n","There are no resources to protect in the web app, therefore the job for the SPA in regards to authentication is simple;"]}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["Is the user logged in?",(0,i.jsx)(t.br,{}),"\n","a) No - Redirect user to authentication server for authentication",(0,i.jsx)(t.br,{}),"\n","b) Yes - Add the JWT to every request to the API"]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Details needed to implement this can be found here; ",(0,i.jsx)(t.a,{href:"https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-auth-code-flow",children:"https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-auth-code-flow"})]}),"\n",(0,i.jsxs)(t.p,{children:["We use the ",(0,i.jsx)(t.a,{href:"https://github.com/soofstad/react-oauth2-pkce",children:"react-oauth2-pkce"})," library to handle this for us."]}),"\n",(0,i.jsx)(t.h2,{id:"rest-api",children:"REST API"}),"\n",(0,i.jsx)(t.p,{children:"The REST API (e.g python FastAPI server) has access to, and is responsible for serving, data that could be private. Therefore we need to validate that the request is coming from an authenticated client."}),"\n",(0,i.jsx)(t.p,{children:"We do that in these steps;"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"Require a JWT on each request"}),"\n",(0,i.jsx)(t.li,{children:"Fetch the RSA public keys from the authentication server."}),"\n",(0,i.jsx)(t.li,{children:"Validate the JWT signature with the auth server's public key"}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["FastAPI has system called ",(0,i.jsx)(t.a,{href:"https://fastapi.tiangolo.com/tutorial/dependencies",children:(0,i.jsx)(t.strong,{children:"dependencies"})})," that is well suited for running a specific function before every request."]}),"\n",(0,i.jsx)(t.p,{children:"Here is an example;"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:"app = FastAPI(title=\"Awesome Boilerplate\")  # Create the FastAPI app\nroutes.include_router(report_router)  # Add a route/controller to the app\n# Add the 'auth_with_jwt()' function as a dependency\n# This function will do the actual JWT validation with step 2 and 3\napp.include_router(routes, dependencies=[Security(auth_with_jwt)])\n"})}),"\n",(0,i.jsx)(t.p,{children:"That's it! Now every route added like this will require a successfull JWT validation before the request will be processed."}),"\n",(0,i.jsxs)(t.p,{children:["Dependencies can also return values, useful if you need to do some kind of ",(0,i.jsx)(t.strong,{children:"authorization"}),".",(0,i.jsx)(t.br,{}),"\n","Here is one example;"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'@router.delete("/{id}", operation_id="delete-report")\ndef delete_report(id: str, user: User = Depends(auth_with_jwt)):\n    if has_permission(user):\n      delete_report(id)\n      return "OK"\n    else:\n      return PlainTextResponse("Permission denied", status_code=402)\n'})})]})}function u(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var i=n(96540);const r={},s=i.createContext(r);function o(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);